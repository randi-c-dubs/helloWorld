<html>
	<head> 
	    <script src="http://code.jquery.com/jquery.js"></script>
	    <script src="bootstrap/js/bootstrap.min.js"></script>
	    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">


	    <!-- 	Map box client side libraries     -->
	    <link href='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
	    <link href="bootstrap/css/index.css" rel="stylesheet">
	    <script src='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js'></script>
	</head>
	
	<style>
	</style>
	
	<body>
		<!--Facebok authentication-->
		<div id="fb-root"></div>
		<script src="//connect.facebook.net/en_US/all.js"></script>
		<script>
		var token;
		var name;
		var email;
		var languages = [];
		var location;
		var lat;
		var lng;
		var fbUrl;
		
		var graphUser_API = "https://www.graphuser.facebook.com/me?fields=name,email,language,location,link&access_token=";


/* FB authentication 
************************************************************************************
*/
		  window.fbAsyncInit = function() {
		    // init the FB JS SDK
		    FB.init({
		      appId      : '540749739313645',                        // App ID from the app dashboard
		      channelUrl : 'ec2-75-101-252-133.compute-1.amazonaws.com/channel.html', // Channel file for x-domain comms
		      cookie     : true,
		      status     : true,                                 // Check Facebook Login status
		      xfbml      : true                                  // Look for social plugins on the page
		    });
		
		    // Additional initialization code such as adding Event Listeners goes here
		    	FB.Event.subscribe('auth.authResponseChange', function(response) {
				    // Here we specify what we do with the response anytime this event occurs. 
				    if (response.status === 'connected') {
				      token = response.authResponse.accessToken;
				      $.get(graphUser_API, function(response){
					      name = response.name;
					      email = response.email;
					      for (var i = 0; i < response.languages.length; i ++){
					      		languages.push(response.languages[i].name);
					      }
					      location = response.location;
					      fbUrl = response.link;
				      });
				      
				      
				      
				      var data = {email:email};
				      $.post("http://ec2-75-101-252-133.compute-1.amazonaws.com/api/signIn", data,function(response){
					     if(response.result == 'Error'){
					     	geocoder.query(location, function(err, result){
						     	if(error){
							     	console.log("geocoderError");
						     	}else{
						     	 
							     data = {email:email, name:name, languages:languages, locationString:location, lat:result.latlng[0][0], lng:result.latlng[0][1], fbUrl:fbUrl};
							     $.post("http://ec2-75-101-252-133.compute-1.amazonaws.com/api/signUp", data, function(response){
								     if(response.result == "Error"){
									     console.log("New Account Error");
								     }else{
									     console.log("Success!");
								     }
							     });
						     	}
					     	});
					     }
				      });
				      
				      //query the signin api  - on "error" go to "api/signup"; on "success" go to map view
				      
				      
				      
				      //query facebook api for graph user data
				      graphUser_API += token;
				      
				    } else if (response.status === 'not_authorized') {
				      
				      
				      FB.login();
				    } else {
				      
				      
				      FB.login();
				    }
				  });
		  };
		  
		  
/* 	FB API state change and events   
************************************************************************************
*/		
		
		  // Load the SDK asynchronously
		  (function(d, s, id){
		     var js, fjs = d.getElementsByTagName(s)[0];
		     if (d.getElementById(id)) {return;}
		     js = d.createElement(s); js.id = id;
		     js.src = "//connect.facebook.net/en_US/all.js";
		     fjs.parentNode.insertBefore(js, fjs);
		   }(document, 'script', 'facebook-jssdk'));
		   
		   FB.api('/me', function(response){
			   
		   });
/* 
************************************************************************************
*/		   
		</script>
	<div id="fb-root" class="pull-right"></div>
	<div class="navbar"><a class="brand">Brand</a></div>
	<div class="navbar navbar-inverse navbar-fixed-top">
	    <div class="container">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
			    <span class="icon-bar"></span>
			    <span class="icon-bar"></span>
			    <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">Hello, World!</a>
			<div class="nav-collapse collapse">
			    <ul class="nav navbar-nav">
				<li><a href="#contact">About</a></li>
			    </ul>
			    <!--/.nav-collapse -->
			</div>
	    </div>
	</div>
	
<!-- Login div -->
	<div class="enter-body">
	    <div id="enter-content">
			<div id="logo"><i id="enter-logo"></i><i id="rotating-world"></i></div>
			<div class="fb-login-button" show-faces="false"></div>
<!-- 		<a href="" id="login">login &#9658;</a> -->
	    </div>
    </div>
    
<!--   Map view div   -->
    <div class="">
	    
	    
    </div>
    
	</body>
</html>